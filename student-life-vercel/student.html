<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Student โ Smart Student Life (Local + AI)</title>
<style>
:root{--bg:#f7fafc;--panel:#fff;--soft:#f1f5f9;--border:#e5e7eb;--ink:#0f172a;--acc:#2563eb;--acc2:#22c55e;--r:16px;--shadow:0 14px 36px rgba(2,6,23,.07)}
*{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,Segoe UI,Roboto,Arial}
nav{position:sticky;top:0;background:var(--panel);border-bottom:1px solid var(--border);z-index:2}
.nav{max-width:1100px;margin:auto;padding:12px 16px;display:flex;justify-content:space-between;align-items:center}
.tabs{display:flex;gap:8px;flex-wrap:wrap}
.tab{padding:8px 12px;border:1px solid var(--border);border-radius:12px;background:var(--soft);cursor:pointer;font-weight:800}
.tab.active{background:var(--acc);border-color:var(--acc);color:#fff}
.container{max-width:1100px;margin:auto;padding:16px}
.card{background:var(--panel);border:1px solid var(--border);border-radius:var(--r);box-shadow:var(--shadow);padding:14px;margin:12px 0}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.btn{padding:10px 14px;border-radius:12px;border:1px solid var(--border);background:var(--soft);cursor:pointer;font-weight:800}
.btn.acc{background:var(--acc);border-color:var(--acc);color:#fff}
.btn.alt{background:var(--acc2);border-color:var(--acc2);color:#052916}
input,select,textarea{padding:10px 12px;border:1px solid var(--border);border-radius:12px;background:#fff;min-width:220px}
.list{display:grid;gap:10px}.item{background:var(--soft);border:1px solid var(--border);border-radius:12px;padding:10px}
.meter{height:10px;background:var(--soft);border:1px solid var(--border);border-radius:999px;overflow:hidden}
.meter>span{display:block;height:100%;background:linear-gradient(90deg,var(--acc),var(--acc2))}
.note{color:#64748b;font-size:13px}
.chat{display:grid;gap:10px}
.chatlog{background:#0f172a;color:#e5e7eb;border-radius:14px;padding:12px;height:260px;overflow:auto;font-size:14px}
.chatlog .m{margin:6px 0;line-height:1.6}.chatlog .ai{color:#c7d2fe}
.tag{display:inline-flex;gap:6px;align-items:center;padding:6px 10px;background:var(--soft);border:1px solid var(--border);border-radius:999px;font-size:12px}
textarea.share{width:100%;min-height:110px}
</style>
</head>
<body>
<nav>
  <div class="nav">
    <strong>Student โ Smart Student Life</strong>
    <div class="tabs" id="tabs">
      <span class="tab active" data-p="goals">ุงูุฃูุฏุงู</span>
      <span class="tab" data-p="health">ุงูุตุญุฉ</span>
      <span class="tab" data-p="ai">AI ูุณุงุนุฏ</span>
      <span class="tab" data-p="share">ูุดุงุฑูุฉ</span>
      <span class="tab" data-p="settings">ุงูุฅุนุฏุงุฏุงุช</span>
    </div>
  </div>
</nav>

<div class="container">
  <section id="page-goals" class="card">
    <h3>ุงูุฃูุฏุงู ุงูููููุฉ</h3>
    <div class="row">
      <input id="sid" placeholder="ุฑูู ุงูุทุงูุจ (S-1001)"/>
      <input id="goalIn" placeholder="ุงูุชุจ ูุฏููุงโฆ"/>
      <select id="scope">
        <option value="daily" selected>ูููู (15๐ช)</option>
        <option value="weekly">ุฃุณุจูุนู (30๐ช)</option>
        <option value="monthly">ุดูุฑู (50๐ช)</option>
        <option value="term">ูุตูู (80๐ช)</option>
        <option value="yearly">ุณููู (200๐ช)</option>
      </select>
      <button class="btn acc" id="addGoal">ุฅุถุงูุฉ</button>
    </div>
    <div class="row" style="margin-top:6px">
      <span class="tag">๐ช <b id="coins">0</b></span>
      <button class="btn" id="completeAll">ุฅููุงุก ุงููู</button>
      <button class="btn" id="clearDone">ุญุฐู ุงูููุชูู</button>
    </div>
    <div class="meter" style="margin:10px 0"><span id="goalsBar" style="width:0%"></span></div>
    <div id="goalsList" class="list"></div>
  </section>

  <section id="page-health" class="card" hidden>
    <h3>ุงูุตุญุฉ</h3>
    <div class="card">
      <h4>ุงูุฎุทูุงุช</h4>
      <div class="row"><input id="steps" placeholder="ุนุฏุฏ ุฎุทูุงุช ุงูููู"/><button class="btn acc" id="saveSteps">ุญูุธ</button></div>
      <p class="note" id="stepsOut">ุฎุทูุงุช: 0 / 11000</p>
      <div class="meter"><span id="stepsBar" style="width:0%"></span></div>
    </div>
    <div class="card">
      <h4>BMI</h4>
      <div class="row"><input id="hCm" placeholder="ุงูุทูู (ุณู)"/><input id="wKg" placeholder="ุงููุฒู (ูุฌู)"/><button class="btn acc" id="bmiBtn">ุญุณุงุจ</button></div>
      <p class="note" id="bmiOut">โ</p>
    </div>
    <div class="card">
      <h4>ุงููุงุก</h4>
      <div class="row"><input id="water" placeholder="ุดุฑุจุช ุงูููู (ูู)"/><button class="btn acc" id="saveWater">ุญูุธ</button></div>
      <p class="note" id="waterOut">0 / 2000 ูู</p>
      <div class="meter"><span id="waterBar" style="width:0%"></span></div>
    </div>
  </section>

  <section id="page-ai" class="card" hidden>
    <h3>ุงููุณุงุนุฏ ุงูุฐูู</h3>
    <div class="card">
      <h4>ุฎุทุฉ ุฃูู 30 ููู (ุฃุณุฆูุฉ ุณุฑูุนุฉ)</h4>
      <div class="row">
        <input id="aiAge" placeholder="ุงูุนูุฑ"/><input id="aiWeight" placeholder="ุงููุฒู (ูุฌู)"/>
        <input id="aiHeight" placeholder="ุงูุทูู (ุณู)"/>
        <select id="aiActivity"><option>ููุฎูุถ</option><option selected>ูุชูุณุท</option><option>ุนุงูู</option></select>
        <input id="aiPrefs" placeholder="ุชูุถููุงุช/ุญุณุงุณูุงุช (ุงุฎุชูุงุฑู)"/>
        <select id="aiGoal"><option>ุญูุธ ุงููุฒู</option><option>ุชูุฒูู ูุฒู</option><option>ุฒูุงุฏุฉ ุทุงูุฉ</option></select>
        <button class="btn acc" id="genMealPlan">ุชูููุฏ ุงูุฎุทุฉ</button>
      </div>
    </div>
    <div class="card">
      <h4>ุงูุชุฑุงุญ ุฃูุฏุงู ุฐููุฉ</h4>
      <button class="btn" id="suggestGoals">ุงูุชุฑุญ ุฃูุฏุงููุง ุจูุงุกู ุนูู ุณุฌูู</button>
    </div>
    <div class="chat">
      <div class="chatlog" id="chatlog"></div>
      <div class="row"><input id="aiMsg" placeholder="ุงุณุฃู AIโฆ"/><button class="btn acc" id="sendAI">ุฅุฑุณุงู</button></div>
    </div>
  </section>

  <section id="page-share" class="card" hidden>
    <h3>ูุดุงุฑูุฉ ุชูุฑูุฑ ููููู/ุงููุนูู</h3>
    <p class="note">ุงุถุบุท ุชูููุฏุ ุซู ุงูุณุฎ ุงูููุฏ ูุฃุฑุณูู ููููู ุงูุฃูุฑ ุฃู ุงููุนููู.</p>
    <div class="row"><button class="btn alt" id="genShare">ุชูููุฏ ููุฏ ูุดุงุฑูุฉ ุงูููู</button></div>
    <textarea class="share" id="shareOut" readonly placeholder="ุณูุธูุฑ ููุฏ ุงููุดุงุฑูุฉ ููุงโฆ"></textarea>
  </section>

  <section id="page-settings" class="card" hidden>
    <h3>ุงูุฅุนุฏุงุฏุงุช</h3>
    <div class="row">
      <input id="openaiKey" style="min-width:520px" placeholder="OpenAI API Key (ููุชุฌุฑุจุฉ)"/>
      <button class="btn acc" id="saveKey">ุญูุธ ููุชุงุญ AI</button>
      <span class="note">ููุฎุฒููู ูุญูููุง ูู ุงููุชุตูุญ.</span>
    </div>
  </section>
</div>

<script>
const $=s=>document.querySelector(s), $$=s=>[...document.querySelectorAll(s)];
function show(p){['goals','health','ai','share','settings'].forEach(x=>$('#page-'+x).hidden=(x!==p)); $$('#tabs .tab').forEach(t=>t.classList.toggle('active',t.dataset.p===p));}
$('#tabs').addEventListener('click',e=>{const a=e.target.closest('.tab'); if(!a)return; show(a.dataset.p);});
$('#openaiKey').value=localStorage.getItem('st:key')||''; $('#saveKey').onclick=()=>{ localStorage.setItem('st:key',$('#openaiKey').value.trim()); alert('ุชู ุงูุญูุธ โ'); };
$('#sid').value=localStorage.getItem('st:sid')||'';
let coins=+localStorage.getItem('st:coins')||0; const setCoins=v=>{coins=v; localStorage.setItem('st:coins',v); $('#coins').textContent=v}; setCoins(coins);
let goals=JSON.parse(localStorage.getItem('st:goals')||'[]'); const uid=()=>Math.random().toString(36).slice(2,9);
const reward=s=>({daily:15,weekly:30,monthly:50,term:80,yearly:200}[s]||0);
function renderGoals(){ const box=$('#goalsList'); box.innerHTML=''; const total=goals.length||1, done=goals.filter(g=>g.done).length; $('#goalsBar').style.width=(done*100/total)+'%';
  goals.slice().reverse().forEach(g=>{ const d=document.createElement('div'); d.className='item';
    d.innerHTML=`<div class="row" style="justify-content:space-between"><div>${g.done?'โ':'โฌ'} ${g.text} <span class="tag">${g.scope}</span> <span class="tag">${reward(g.scope)}๐ช</span></div>
    <div class="row"><button class="btn" data-a="done" data-id="${g.id}">${g.done?'ุฅูุบุงุก':'ุฅูุฌุงุฒ'}</button><button class="btn" data-a="del" data-id="${g.id}">ุญุฐู</button></div></div>`; box.appendChild(d); });
}
$('#addGoal').onclick=()=>{ const t=$('#goalIn').value.trim(); if(!t) return; const g={id:uid(),text:t,scope:$('#scope').value,done:false}; goals.push(g); localStorage.setItem('st:goals',JSON.stringify(goals)); $('#goalIn').value=''; renderGoals(); };
$('#goalsList').addEventListener('click',e=>{ const b=e.target.closest('button'); if(!b) return; const id=b.dataset.id; const a=b.dataset.a; const g=goals.find(x=>x.id===id); if(!g) return;
  if(a==='done'){ g.done=!g.done; setCoins(coins+(g.done?reward(g.scope):-reward(g.scope))); } else if(a==='del'){ goals=goals.filter(x=>x.id!==id); }
  localStorage.setItem('st:goals',JSON.stringify(goals)); renderGoals();
});
$('#completeAll').onclick=()=>{ goals.forEach(g=>{ if(!g.done){ g.done=true; setCoins(coins+reward(g.scope)); }}); localStorage.setItem('st:goals',JSON.stringify(goals)); renderGoals(); };
$('#clearDone').onclick=()=>{ goals=goals.filter(g=>!g.done); localStorage.setItem('st:goals',JSON.stringify(goals)); renderGoals(); };
function renderSteps(){ const v=+localStorage.getItem('st:steps')||0; $('#stepsOut').textContent=`ุฎุทูุงุช: ${v} / 11000`; $('#stepsBar').style.width=Math.min(100,Math.round(v*100/11000))+'%'; }
$('#saveSteps').onclick=()=>{ const v=+($('#steps').value||0); localStorage.setItem('st:steps',v); renderSteps(); if(v>=11000) alert('ููุชุงุฒ! ูุตูุช ุงููุฏู ๐ +15๐ช'); };
$('#bmiBtn').onclick=()=>{ const h=+$('#hCm').value/100, w=+$('#wKg').value; if(!h||!w) return $('#bmiOut').textContent='ุฃุฏุฎู ุงูููู'; const bmi=(w/(h*h)).toFixed(1);
  let s=''; if(bmi<18.5)s='ูุญูู'; else if(bmi<25)s='ุทุจูุนู'; else if(bmi<30)s='ูุฒู ุฒุงุฆุฏ'; else s='ุณููุฉ'; $('#bmiOut').textContent=`BMI ${bmi} (${s})`; };
function renderWater(){ const v=+localStorage.getItem('st:water')||0; const pct=Math.min(100,Math.round(v*100/2000)); $('#waterOut').textContent=`${v} / 2000 ูู`; $('#waterBar').style.width=pct+'%'; }
$('#saveWater').onclick=()=>{ const v=+($('#water').value||0); localStorage.setItem('st:water',v); renderWater(); };
function compress(obj){ return btoa(unescape(encodeURIComponent(JSON.stringify(obj)))); }
$('#genShare').onclick=()=>{ const sid=($('#sid').value||'').trim(); if(!sid) return alert('ุฃุฏุฎู ุฑูู ุงูุทุงูุจ'); localStorage.setItem('st:sid',sid);
  const data={ studentId:sid, date:new Date().toISOString().slice(0,10),
    completedGoals:goals.filter(g=>g.done).length, totalGoals:goals.length,
    steps:(+localStorage.getItem('st:steps')||0), water:(+localStorage.getItem('st:water')||0),
    bmi:($('#bmiOut').textContent||''), points:coins,
    goalsDone:goals.filter(g=>g.done).map(g=>g.text), goalsPending:goals.filter(g=>!g.done).map(g=>g.text)
  };
  $('#shareOut').value=compress(data);
  alert('ุชู ุชูููุฏ ููุฏ ุงููุดุงุฑูุฉ โ');
};
function pushChat(role, text){ const log=$('#chatlog'); const div=document.createElement('div'); div.className='m '+role; div.textContent=(role==='ai'?'๐ค ':'๐ง ')+text; log.appendChild(div); log.scrollTop=log.scrollHeight; }
async function callAI(prompt){
  const key=(localStorage.getItem('st:key')||'').trim(); if(!key){ pushChat('ai','ุฃุฏุฎู OpenAI API Key ูู ุงูุฅุนุฏุงุฏุงุช'); return ''; }
  const body={model:"gpt-4o-mini",messages:[{role:"system",content:"You are an Arabic coach for students (study, health, nutrition)."}, {role:"user",content:prompt}],temperature:0.7};
  const r=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json","Authorization":"Bearer "+key},body:JSON.stringify(body)}); const j=await r.json(); return j?.choices?.[0]?.message?.content?.trim()||"";
}
$('#sendAI').onclick=async()=>{ const msg=$('#aiMsg').value.trim(); if(!msg) return; pushChat('me',msg); $('#aiMsg').value=''; try{ const res=await callAI(msg); if(res) pushChat('ai',res);}catch(e){ pushChat('ai','ุฎุทุฃ: '+e.message); } };
$('#genMealPlan').onclick=async()=>{ const age=$('#aiAge').value||'', w=$('#aiWeight').value||'', h=$('#aiHeight').value||'', act=$('#aiActivity').value||'', prefs=$('#aiPrefs').value||'', g=$('#aiGoal').value||'';
  const prompt=`ุฃูุดุฆ ุฎุทุฉ ุฃูู ุนุฑุจูุฉ ุจุณูุทุฉ ููุฏุฉ 30 ููู ูุทุงูุจ ุนูุฑู ${age}ุ ูุฒูู ${w} ูุฌู ูุทููู ${h} ุณูุ ูุดุงุท ${act}ุ ูุฏู: ${g}. ุฑุงุนู: ${prefs}. ุถุน ุงูุฎุทุฉ ูุฃูุงู 1..30 (ูุทูุฑ/ุบุฏุงุก/ุนุดุงุก/ุณูุงู).`;
  pushChat('me','ุชูููุฏ ุฎุทุฉ 30 ูููโฆ'); try{ const res=await callAI(prompt); if(res) pushChat('ai',res);}catch(e){ pushChat('ai','ุฎุทุฃ: '+e.message); } };
$('#suggestGoals').onclick=async()=>{ const done=goals.filter(g=>g.done).map(g=>`โ ${g.text}`), pen=goals.filter(g=>!g.done).map(g=>`- ${g.text}`), steps=+localStorage.getItem('st:steps')||0, bmi=$('#bmiOut').textContent||'';
  const prompt=`ุฃูุง ุทุงูุจ. ุงูููุฌุฒ: ${done.join(' | ')||'ูุง ุดูุก'}. ุงููุชุจูู: ${pen.join(' | ')||'ูุง ุดูุก'}. ุฎุทูุงุช ุงูููู ${steps}. BMI ${bmi}. ุงูุชุฑุญ 8 ุฃูุฏุงู ุฐููุฉ ูุงุจูุฉ ููููุงุณ ููุฃุณุจูุน ุงููุงุฏู (ุฏุฑุงุณุฉ/ุตุญุฉ/ุนุงุฏุงุช) ูุน ููุงุท (5-20) ููุตูุญุฉ ูุตูุฑุฉ ููู ูุฏู.`;
  pushChat('me','ุงูุชุฑุญ ุฃูุฏุงููุงโฆ'); try{ const res=await callAI(prompt); if(res) pushChat('ai',res);}catch(e){ pushChat('ai','ุฎุทุฃ: '+e.message); } };
function init(){ renderGoals(); renderSteps(); renderWater(); show('goals'); } init();
</script>
</body></html>
