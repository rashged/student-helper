
<!DOCTYPE html><html lang="ar" dir="rtl"><head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ø§Ù„Ø·Ø§Ù„Ø¨</title><link rel="stylesheet" href="styles.css"></head><body>
<header><img src="logo.svg" class="logo"><h2>Ù„ÙˆØ­Ø© Ø§Ù„Ø·Ø§Ù„Ø¨</h2><span class="tag">ğŸª™ <b id="coins">0</b></span></header>
<div class="container">
  <div class="card"><h3>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
    <div class="row"><input id="key" placeholder="OpenAI API Key"><button class="btn acc" id="saveKey">Ø­ÙØ¸</button></div>
  </div>
  <div class="card"><h3>Ø§Ù„Ø£Ù‡Ø¯Ø§Ù</h3>
    <div class="row"><input id="sid" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ (S-1001)"><input id="gIn" placeholder="Ù‡Ø¯Ù Ø¬Ø¯ÙŠØ¯"><select id="scope">
      <option value="daily">ÙŠÙˆÙ…ÙŠ (15)</option><option value="weekly">Ø£Ø³Ø¨ÙˆØ¹ÙŠ (30)</option><option value="monthly">Ø´Ù‡Ø±ÙŠ (50)</option><option value="term">ÙØµÙ„ÙŠ (80)</option><option value="yearly">Ø³Ù†ÙˆÙŠ (200)</option>
    </select><button class="btn acc" id="addG">Ø¥Ø¶Ø§ÙØ©</button></div>
    <div class="meter" style="margin:8px 0"><span id="gBar" style="width:0%"></span></div>
    <ul id="gList"></ul>
    <div class="row"><button class="btn" id="doneAll">Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„ÙƒÙ„</button><button class="btn" id="clearDone">Ø­Ø°Ù Ø§Ù„Ù…ÙƒØªÙ…Ù„</button></div>
  </div>
  <div class="card"><h3>Ø§Ù„ØµØ­Ø©</h3>
    <div class="row"><input id="steps" placeholder="Ø®Ø·ÙˆØ§Øª Ø§Ù„ÙŠÙˆÙ…"><button class="btn acc" id="saveSteps">Ø­ÙØ¸</button><span class="tag">Ù‡Ø¯Ù 11000</span></div>
    <div class="meter"><span id="sBar" style="width:0%"></span></div>
    <div class="row" style="margin-top:8px"><input id="h" placeholder="Ø§Ù„Ø·ÙˆÙ„ (Ø³Ù…)"><input id="w" placeholder="Ø§Ù„ÙˆØ²Ù† (ÙƒØ¬Ù…)"><button class="btn" id="bmiBtn">BMI</button><span class="tag" id="bmiOut">â€”</span></div>
    <div class="row" style="margin-top:8px"><input id="water" placeholder="Ø´Ø±Ø¨Øª (Ù…Ù„)"><button class="btn" id="saveWater">Ø­ÙØ¸</button><span class="tag" id="wOut">0/2000</span></div>
  </div>
  <div class="card"><h3>Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ (Ø´Ø§Øª)</h3>
    <div class="chat" id="log"></div>
    <div class="row"><input id="msg" placeholder="Ø§Ø³Ø£Ù„ Ø¹Ù† Ø®Ø·Ø© Ø£ÙƒÙ„/Ø¯Ø±Ø§Ø³Ø©â€¦"><button class="btn acc" id="send">Ø¥Ø±Ø³Ø§Ù„</button></div>
    <div class="row"><button class="btn" id="genPlan">ØªÙˆÙ„ÙŠØ¯ Ø®Ø·Ø© 30 ÙŠÙˆÙ…</button></div>
  </div>
  <div class="card"><h3>Ù…Ø´Ø§Ø±ÙƒØ©</h3>
    <button class="btn acc" id="share">ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ Ù…Ø´Ø§Ø±ÙƒØ©</button>
    <textarea id="shareOut" placeholder="Ø³ÙŠØ¸Ù‡Ø± Ø§Ù„ÙƒÙˆØ¯ Ù‡Ù†Ø§â€¦" readonly></textarea>
  </div>
  <div class="card"><h3>Ø§Ù„Ù…ØªØ¬Ø±</h3><div class="grid" id="shop"></div></div>
</div>
<script type="module">
  import { $, $$, getKey, setKey, b64e, ai } from './shared.js';
  // state
  $('#key').value=getKey('st')||''; $('#saveKey').onclick=()=>{ setKey('st',$('#key').value); alert('ØªÙ… Ø§Ù„Ø­ÙØ¸'); };
  let coins=+localStorage.getItem('st:coins')||0; const setCoins=v=>{coins=v; localStorage.setItem('st:coins',v); $('#coins').textContent=v}; setCoins(coins);
  let goals=JSON.parse(localStorage.getItem('st:goals')||'[]');
  const R=s=>({daily:15,weekly:30,monthly:50,term:80,yearly:200}[s]||0);
  function renderGoals(){ const list=$('#gList'); list.innerHTML=''; const total=goals.length||1, done=goals.filter(g=>g.done).length; $('#gBar').style.width=(done*100/total)+'%';
    goals.forEach((g,i)=>{ const li=document.createElement('li'); li.innerHTML=(g.done?'âœ… ':'â¬œ ')+g.text+` <span class="tag">${g.scope} ${R(g.scope)}</span> <button class="btn" data-i="${i}" data-a="t">Ø¥Ù†Ø¬Ø§Ø²</button> <button class="btn" data-i="${i}" data-a="d">Ø­Ø°Ù</button>`; list.appendChild(li); });
  }
  $('#addG').onclick=()=>{ const t=$('#gIn').value.trim(); const sc=$('#scope').value; if(!t) return; goals.push({text:t,scope:sc,done:false}); localStorage.setItem('st:goals',JSON.stringify(goals)); $('#gIn').value=''; renderGoals(); };
  $('#gList').onclick=(e)=>{ const b=e.target.closest('button'); if(!b) return; const i=+b.dataset.i; const a=b.dataset.a; if(a==='t'){ goals[i].done=!goals[i].done; setCoins(coins+(goals[i].done?R(goals[i].scope):-R(goals[i].scope))); } else { goals.splice(i,1);} localStorage.setItem('st:goals',JSON.stringify(goals)); renderGoals(); };
  $('#doneAll').onclick=()=>{ goals.forEach(g=>{ if(!g.done){ g.done=true; setCoins(coins+R(g.scope)); }}); localStorage.setItem('st:goals',JSON.stringify(goals)); renderGoals(); };
  $('#clearDone').onclick=()=>{ goals=goals.filter(g=>!g.done); localStorage.setItem('st:goals',JSON.stringify(goals)); renderGoals(); };
  // health
  function rs(){ const v=+localStorage.getItem('st:steps')||0; $('#sBar').style.width=Math.min(100,Math.round(v*100/11000))+'%'; }
  $('#saveSteps').onclick=()=>{ const v=+($('#steps').value||0); localStorage.setItem('st:steps',v); rs(); if(v>=11000){ alert('ğŸ‰ Ù…Ù…ØªØ§Ø²! +15'); setCoins(coins+15);} };
  $('#bmiBtn').onclick=()=>{ const h=+$('#h').value/100, w=+$('#w').value; if(!h||!w) return $('#bmiOut').textContent='Ø£Ø¯Ø®Ù„ Ø§Ù„Ù‚ÙŠÙ…'; const bmi=(w/(h*h)).toFixed(1); let s=''; if(bmi<18.5)s='Ù†Ø­ÙŠÙ'; else if(bmi<25)s='Ø·Ø¨ÙŠØ¹ÙŠ'; else if(bmi<30)s='ÙˆØ²Ù† Ø²Ø§Ø¦Ø¯'; else s='Ø³Ù…Ù†Ø©'; $('#bmiOut').textContent=`BMI ${bmi} (${s})`; };
  function rw(){ const v=+localStorage.getItem('st:water')||0; $('#wOut').textContent=`${v}/2000`; }
  $('#saveWater').onclick=()=>{ const v=+($('#water').value||0); localStorage.setItem('st:water',v); rw(); };
  // share
  $('#share').onclick=()=>{ const sid=($('#sid').value||'').trim()||'S-000'; localStorage.setItem('st:sid',sid);
    const data={ studentId:sid, date:new Date().toISOString().slice(0,10), completedGoals:goals.filter(g=>g.done).length, totalGoals:goals.length, steps:+(localStorage.getItem('st:steps')||0), water:+(localStorage.getItem('st:water')||0), bmi:($('#bmiOut').textContent||''), points:coins, goalsDone:goals.filter(g=>g.done).map(g=>g.text), goalsPending:goals.filter(g=>!g.done).map(g=>g.text)};
    $('#shareOut').value=b64e(data); alert('âœ… ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙƒÙˆØ¯');
  };
  // AI chat
  const log=$('#log'); const push=(cls,txt)=>{ const d=document.createElement('div'); d.className='msg '+cls; d.textContent=txt; log.appendChild(d); log.scrollTop=log.scrollHeight; };
  $('#send').onclick=async()=>{ const m=$('#msg').value.trim(); if(!m) return; $('#msg').value=''; push('me',m); try{ const res=await ai('st', m,"Ù…Ø¯Ø±Ù‘Ø¨ Ø¹Ø±Ø¨ÙŠ Ù„Ù„Ø·Ù„Ø§Ø¨: ØµØ­Ø©ØŒ Ø¯Ø±Ø§Ø³Ø©ØŒ ØªØºØ°ÙŠØ©."); push('ai',res);}catch(e){ push('ai','Ø®Ø·Ø£: '+e.message);} };
  $('#genPlan').onclick=async()=>{ try{ push('me','Ø£Ø±ÙŠØ¯ Ø®Ø·Ø© 30 ÙŠÙˆÙ…'); const res=await ai('st',"Ø£Ù†Ø´Ø¦ Ø®Ø·Ø© Ø£ÙƒÙ„ Ø¹Ø±Ø¨ÙŠØ© Ø¨Ø³ÙŠØ·Ø© Ù„Ù…Ø¯Ø© 30 ÙŠÙˆÙ… Ù„Ø·Ø§Ù„Ø¨. Ø¶Ø¹ Ø§Ù„Ø£ÙŠØ§Ù… 1..30 Ù…Ø¹ ÙØ·ÙˆØ±/ØºØ¯Ø§Ø¡/Ø¹Ø´Ø§Ø¡/Ø³Ù†Ø§Ùƒ Ø¨Ù†Ù‚Ø§Ø· Ù…Ø®ØªØµØ±Ø©."); push('ai',res);}catch(e){ push('ai','Ø®Ø·Ø£: '+e.message);} };
  // shop
  const grid=$('#shop'); ['ğŸ™‚','ğŸ˜','ğŸ¯','ğŸ¦‰','ğŸ±','ğŸ¼'].forEach(em=>{ const d=document.createElement('div'); d.className='prod'; d.innerHTML=`<div style="font-size:54px">${em}</div><button class="btn">ØªØ¹ÙŠÙŠÙ†</button>`; d.querySelector('button').onclick=()=>{ localStorage.setItem('sl:avatar',em); alert('ØªÙ… ØªØ¹ÙŠÙŠÙ† '+em); }; grid.appendChild(d); });
  // init
  rs(); rw(); renderGoals();
</script>
</body></html>
