<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Student â€“ Smart Student Life (Local + AI)</title>
<style>
:root{--bg:#f7fafc;--panel:#fff;--soft:#f1f5f9;--border:#e5e7eb;--ink:#0f172a;--acc:#2563eb;--acc2:#22c55e;--r:16px;--shadow:0 14px 36px rgba(2,6,23,.07)}
*{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,Segoe UI,Roboto,Arial}
nav{position:sticky;top:0;background:var(--panel);border-bottom:1px solid var(--border);z-index:2}
.nav{max-width:1100px;margin:auto;padding:12px 16px;display:flex;justify-content:space-between;align-items:center}
.tabs{display:flex;gap:8px;flex-wrap:wrap}
.tab{padding:8px 12px;border:1px solid var(--border);border-radius:12px;background:var(--soft);cursor:pointer;font-weight:800}
.tab.active{background:var(--acc);border-color:var(--acc);color:#fff}
.container{max-width:1100px;margin:auto;padding:16px}
.card{background:var(--panel);border:1px solid var(--border);border-radius:var(--r);box-shadow:var(--shadow);padding:14px;margin:12px 0}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.btn{padding:10px 14px;border-radius:12px;border:1px solid var(--border);background:var(--soft);cursor:pointer;font-weight:800}
.btn.acc{background:var(--acc);border-color:var(--acc);color:#fff}
.btn.alt{background:var(--acc2);border-color:var(--acc2);color:#052916}
input,select,textarea{padding:10px 12px;border:1px solid var(--border);border-radius:12px;background:#fff;min-width:220px}
.list{display:grid;gap:10px}.item{background:var(--soft);border:1px solid var(--border);border-radius:12px;padding:10px}
.meter{height:10px;background:var(--soft);border:1px solid var(--border);border-radius:999px;overflow:hidden}
.meter>span{display:block;height:100%;background:linear-gradient(90deg,var(--acc),var(--acc2))}
.note{color:#64748b;font-size:13px}
.chat{display:grid;gap:10px}
.chatlog{background:#0f172a;color:#e5e7eb;border-radius:14px;padding:12px;height:260px;overflow:auto;font-size:14px}
.chatlog .m{margin:6px 0;line-height:1.6}.chatlog .ai{color:#c7d2fe}
.tag{display:inline-flex;gap:6px;align-items:center;padding:6px 10px;background:var(--soft);border:1px solid var(--border);border-radius:999px;font-size:12px}
textarea.share{width:100%;min-height:110px}
</style>
</head>
<body>
<nav>
  <div class="nav">
    <strong>Student â€“ Smart Student Life</strong>
    <div class="tabs" id="tabs">
      <span class="tab active" data-p="goals">Ø§Ù„Ø£Ù‡Ø¯Ø§Ù</span>
      <span class="tab" data-p="health">Ø§Ù„ØµØ­Ø©</span>
      <span class="tab" data-p="ai">AI Ù…Ø³Ø§Ø¹Ø¯</span>
      <span class="tab" data-p="share">Ù…Ø´Ø§Ø±ÙƒØ©</span>
      <span class="tab" data-p="settings">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
    </div>
  </div>
</nav>

<div class="container">
  <section id="page-goals" class="card">
    <h3>Ø§Ù„Ø£Ù‡Ø¯Ø§Ù Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h3>
    <div class="row">
      <input id="sid" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ (S-1001)"/>
      <input id="goalIn" placeholder="Ø§ÙƒØªØ¨ Ù‡Ø¯ÙÙ‹Ø§â€¦"/>
      <select id="scope">
        <option value="daily" selected>ÙŠÙˆÙ…ÙŠ (15ğŸª™)</option>
        <option value="weekly">Ø£Ø³Ø¨ÙˆØ¹ÙŠ (30ğŸª™)</option>
        <option value="monthly">Ø´Ù‡Ø±ÙŠ (50ğŸª™)</option>
        <option value="term">ÙØµÙ„ÙŠ (80ğŸª™)</option>
        <option value="yearly">Ø³Ù†ÙˆÙŠ (200ğŸª™)</option>
      </select>
      <button class="btn acc" id="addGoal">Ø¥Ø¶Ø§ÙØ©</button>
    </div>
    <div class="row" style="margin-top:6px">
      <span class="tag">ğŸª™ <b id="coins">0</b></span>
      <button class="btn" id="completeAll">Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„ÙƒÙ„</button>
      <button class="btn" id="clearDone">Ø­Ø°Ù Ø§Ù„Ù…ÙƒØªÙ…Ù„</button>
    </div>
    <div class="meter" style="margin:10px 0"><span id="goalsBar" style="width:0%"></span></div>
    <div id="goalsList" class="list"></div>
  </section>

  <section id="page-health" class="card" hidden>
    <h3>Ø§Ù„ØµØ­Ø©</h3>
    <div class="card">
      <h4>Ø§Ù„Ø®Ø·ÙˆØ§Øª</h4>
      <div class="row"><input id="steps" placeholder="Ø¹Ø¯Ø¯ Ø®Ø·ÙˆØ§Øª Ø§Ù„ÙŠÙˆÙ…"/><button class="btn acc" id="saveSteps">Ø­ÙØ¸</button></div>
      <p class="note" id="stepsOut">Ø®Ø·ÙˆØ§Øª: 0 / 11000</p>
      <div class="meter"><span id="stepsBar" style="width:0%"></span></div>
    </div>
    <div class="card">
      <h4>BMI</h4>
      <div class="row"><input id="hCm" placeholder="Ø§Ù„Ø·ÙˆÙ„ (Ø³Ù…)"/><input id="wKg" placeholder="Ø§Ù„ÙˆØ²Ù† (ÙƒØ¬Ù…)"/><button class="btn acc" id="bmiBtn">Ø­Ø³Ø§Ø¨</button></div>
      <p class="note" id="bmiOut">â€”</p>
    </div>
    <div class="card">
      <h4>Ø§Ù„Ù…Ø§Ø¡</h4>
      <div class="row"><input id="water" placeholder="Ø´Ø±Ø¨Øª Ø§Ù„ÙŠÙˆÙ… (Ù…Ù„)"/><button class="btn acc" id="saveWater">Ø­ÙØ¸</button></div>
      <p class="note" id="waterOut">0 / 2000 Ù…Ù„</p>
      <div class="meter"><span id="waterBar" style="width:0%"></span></div>
    </div>
  </section>

  <section id="page-ai" class="card" hidden>
    <h3>Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ</h3>
    <div class="card">
      <h4>Ø®Ø·Ø© Ø£ÙƒÙ„ 30 ÙŠÙˆÙ… (Ø£Ø³Ø¦Ù„Ø© Ø³Ø±ÙŠØ¹Ø©)</h4>
      <div class="row">
        <input id="aiAge" placeholder="Ø§Ù„Ø¹Ù…Ø±"/><input id="aiWeight" placeholder="Ø§Ù„ÙˆØ²Ù† (ÙƒØ¬Ù…)"/>
        <input id="aiHeight" placeholder="Ø§Ù„Ø·ÙˆÙ„ (Ø³Ù…)"/>
        <select id="aiActivity"><option>Ù…Ù†Ø®ÙØ¶</option><option selected>Ù…ØªÙˆØ³Ø·</option><option>Ø¹Ø§Ù„Ù</option></select>
        <input id="aiPrefs" placeholder="ØªÙØ¶ÙŠÙ„Ø§Øª/Ø­Ø³Ø§Ø³ÙŠØ§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"/>
        <select id="aiGoal"><option>Ø­ÙØ¸ Ø§Ù„ÙˆØ²Ù†</option><option>ØªÙ†Ø²ÙŠÙ„ ÙˆØ²Ù†</option><option>Ø²ÙŠØ§Ø¯Ø© Ø·Ø§Ù‚Ø©</option></select>
        <button class="btn acc" id="genMealPlan">ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø®Ø·Ø©</button>
      </div>
    </div>
    <div class="card">
      <h4>Ø§Ù‚ØªØ±Ø§Ø­ Ø£Ù‡Ø¯Ø§Ù Ø°ÙƒÙŠØ©</h4>
      <button class="btn" id="suggestGoals">Ø§Ù‚ØªØ±Ø­ Ø£Ù‡Ø¯Ø§ÙÙ‹Ø§ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø³Ø¬Ù„ÙŠ</button>
    </div>
    <div class="chat">
      <div class="chatlog" id="chatlog"></div>
      <div class="row"><input id="aiMsg" placeholder="Ø§Ø³Ø£Ù„ AIâ€¦"/><button class="btn acc" id="sendAI">Ø¥Ø±Ø³Ø§Ù„</button></div>
    </div>
  </section>

  <section id="page-share" class="card" hidden>
    <h3>Ù…Ø´Ø§Ø±ÙƒØ© ØªÙ‚Ø±ÙŠØ± Ù„Ù„ÙˆÙ„ÙŠ/Ø§Ù„Ù…Ø¹Ù„Ù…</h3>
    <p class="note">Ø§Ø¶ØºØ· ØªÙˆÙ„ÙŠØ¯ØŒ Ø«Ù… Ø§Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯ ÙˆØ£Ø±Ø³Ù„Ù‡ Ù„ÙˆÙ„ÙŠÙ‘ Ø§Ù„Ø£Ù…Ø± Ø£Ùˆ Ø§Ù„Ù…Ø¹Ù„Ù‘Ù….</p>
    <div class="row"><button class="btn alt" id="genShare">ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ÙŠÙˆÙ…</button></div>
    <textarea class="share" id="shareOut" readonly placeholder="Ø³ÙŠØ¸Ù‡Ø± ÙƒÙˆØ¯ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ù‡Ù†Ø§â€¦"></textarea>
  </section>

  <section id="page-settings" class="card" hidden>
    <h3>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
    <div class="row">
      <input id="openaiKey" style="min-width:520px" placeholder="OpenAI API Key (Ù„Ù„ØªØ¬Ø±Ø¨Ø©)"/>
      <button class="btn acc" id="saveKey">Ø­ÙØ¸ Ù…ÙØªØ§Ø­ AI</button>
      <span class="note">ÙŠÙØ®Ø²Ù‘ÙÙ† Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­.</span>
    </div>
  </section>
</div>

<script>
const $=s=>document.querySelector(s), $$=s=>[...document.querySelectorAll(s)];
function show(p){['goals','health','ai','share','settings'].forEach(x=>$('#page-'+x).hidden=(x!==p)); $$('#tabs .tab').forEach(t=>t.classList.toggle('active',t.dataset.p===p));}
$('#tabs').addEventListener('click',e=>{const a=e.target.closest('.tab'); if(!a)return; show(a.dataset.p);});
$('#openaiKey').value=localStorage.getItem('st:key')||''; $('#saveKey').onclick=()=>{ localStorage.setItem('st:key',$('#openaiKey').value.trim()); alert('ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…'); };
$('#sid').value=localStorage.getItem('st:sid')||'';
let coins=+localStorage.getItem('st:coins')||0; const setCoins=v=>{coins=v; localStorage.setItem('st:coins',v); $('#coins').textContent=v}; setCoins(coins);
let goals=JSON.parse(localStorage.getItem('st:goals')||'[]'); const uid=()=>Math.random().toString(36).slice(2,9);
const reward=s=>({daily:15,weekly:30,monthly:50,term:80,yearly:200}[s]||0);
function renderGoals(){ const box=$('#goalsList'); box.innerHTML=''; const total=goals.length||1, done=goals.filter(g=>g.done).length; $('#goalsBar').style.width=(done*100/total)+'%';
  goals.slice().reverse().forEach(g=>{ const d=document.createElement('div'); d.className='item';
    d.innerHTML=`<div class="row" style="justify-content:space-between"><div>${g.done?'âœ…':'â¬œ'} ${g.text} <span class="tag">${g.scope}</span> <span class="tag">${reward(g.scope)}ğŸª™</span></div>
    <div class="row"><button class="btn" data-a="done" data-id="${g.id}">${g.done?'Ø¥Ù„ØºØ§Ø¡':'Ø¥Ù†Ø¬Ø§Ø²'}</button><button class="btn" data-a="del" data-id="${g.id}">Ø­Ø°Ù</button></div></div>`; box.appendChild(d); });
}
$('#addGoal').onclick=()=>{ const t=$('#goalIn').value.trim(); if(!t) return; const g={id:uid(),text:t,scope:$('#scope').value,done:false}; goals.push(g); localStorage.setItem('st:goals',JSON.stringify(goals)); $('#goalIn').value=''; renderGoals(); };
$('#goalsList').addEventListener('click',e=>{ const b=e.target.closest('button'); if(!b) return; const id=b.dataset.id; const a=b.dataset.a; const g=goals.find(x=>x.id===id); if(!g) return;
  if(a==='done'){ g.done=!g.done; setCoins(coins+(g.done?reward(g.scope):-reward(g.scope))); } else if(a==='del'){ goals=goals.filter(x=>x.id!==id); }
  localStorage.setItem('st:goals',JSON.stringify(goals)); renderGoals();
});
$('#completeAll').onclick=()=>{ goals.forEach(g=>{ if(!g.done){ g.done=true; setCoins(coins+reward(g.scope)); }}); localStorage.setItem('st:goals',JSON.stringify(goals)); renderGoals(); };
$('#clearDone').onclick=()=>{ goals=goals.filter(g=>!g.done); localStorage.setItem('st:goals',JSON.stringify(goals)); renderGoals(); };
function renderSteps(){ const v=+localStorage.getItem('st:steps')||0; $('#stepsOut').textContent=`Ø®Ø·ÙˆØ§Øª: ${v} / 11000`; $('#stepsBar').style.width=Math.min(100,Math.round(v*100/11000))+'%'; }
$('#saveSteps').onclick=()=>{ const v=+($('#steps').value||0); localStorage.setItem('st:steps',v); renderSteps(); if(v>=11000) alert('Ù…Ù…ØªØ§Ø²! ÙˆØµÙ„Øª Ø§Ù„Ù‡Ø¯Ù ğŸ‰ +15ğŸª™'); };
$('#bmiBtn').onclick=()=>{ const h=+$('#hCm').value/100, w=+$('#wKg').value; if(!h||!w) return $('#bmiOut').textContent='Ø£Ø¯Ø®Ù„ Ø§Ù„Ù‚ÙŠÙ…'; const bmi=(w/(h*h)).toFixed(1);
  let s=''; if(bmi<18.5)s='Ù†Ø­ÙŠÙ'; else if(bmi<25)s='Ø·Ø¨ÙŠØ¹ÙŠ'; else if(bmi<30)s='ÙˆØ²Ù† Ø²Ø§Ø¦Ø¯'; else s='Ø³Ù…Ù†Ø©'; $('#bmiOut').textContent=`BMI ${bmi} (${s})`; };
function renderWater(){ const v=+localStorage.getItem('st:water')||0; const pct=Math.min(100,Math.round(v*100/2000)); $('#waterOut').textContent=`${v} / 2000 Ù…Ù„`; $('#waterBar').style.width=pct+'%'; }
$('#saveWater').onclick=()=>{ const v=+($('#water').value||0); localStorage.setItem('st:water',v); renderWater(); };
function compress(obj){ return btoa(unescape(encodeURIComponent(JSON.stringify(obj)))); }
$('#genShare').onclick=()=>{ const sid=($('#sid').value||'').trim(); if(!sid) return alert('Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø·Ø§Ù„Ø¨'); localStorage.setItem('st:sid',sid);
  const data={ studentId:sid, date:new Date().toISOString().slice(0,10),
    completedGoals:goals.filter(g=>g.done).length, totalGoals:goals.length,
    steps:(+localStorage.getItem('st:steps')||0), water:(+localStorage.getItem('st:water')||0),
    bmi:($('#bmiOut').textContent||''), points:coins,
    goalsDone:goals.filter(g=>g.done).map(g=>g.text), goalsPending:goals.filter(g=>!g.done).map(g=>g.text)
  };
  $('#shareOut').value=compress(data);
  alert('ØªÙ… ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© âœ…');
};
function pushChat(role, text){ const log=$('#chatlog'); const div=document.createElement('div'); div.className='m '+role; div.textContent=(role==='ai'?'ğŸ¤– ':'ğŸ§‘ ')+text; log.appendChild(div); log.scrollTop=log.scrollHeight; }
async function callAI(prompt){
  const key=(localStorage.getItem('st:key')||'').trim(); if(!key){ pushChat('ai','Ø£Ø¯Ø®Ù„ OpenAI API Key ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª'); return ''; }
  const body={model:"gpt-4o-mini",messages:[{role:"system",content:"You are an Arabic coach for students (study, health, nutrition)."}, {role:"user",content:prompt}],temperature:0.7};
  const r=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json","Authorization":"Bearer "+key},body:JSON.stringify(body)}); const j=await r.json(); return j?.choices?.[0]?.message?.content?.trim()||"";
}
$('#sendAI').onclick=async()=>{ const msg=$('#aiMsg').value.trim(); if(!msg) return; pushChat('me',msg); $('#aiMsg').value=''; try{ const res=await callAI(msg); if(res) pushChat('ai',res);}catch(e){ pushChat('ai','Ø®Ø·Ø£: '+e.message); } };
$('#genMealPlan').onclick=async()=>{ const age=$('#aiAge').value||'', w=$('#aiWeight').value||'', h=$('#aiHeight').value||'', act=$('#aiActivity').value||'', prefs=$('#aiPrefs').value||'', g=$('#aiGoal').value||'';
  const prompt=`Ø£Ù†Ø´Ø¦ Ø®Ø·Ø© Ø£ÙƒÙ„ Ø¹Ø±Ø¨ÙŠØ© Ø¨Ø³ÙŠØ·Ø© Ù„Ù…Ø¯Ø© 30 ÙŠÙˆÙ… Ù„Ø·Ø§Ù„Ø¨ Ø¹Ù…Ø±Ù‡ ${age}ØŒ ÙˆØ²Ù†Ù‡ ${w} ÙƒØ¬Ù… ÙˆØ·ÙˆÙ„Ù‡ ${h} Ø³Ù…ØŒ Ù†Ø´Ø§Ø· ${act}ØŒ Ù‡Ø¯Ù: ${g}. Ø±Ø§Ø¹Ù: ${prefs}. Ø¶Ø¹ Ø§Ù„Ø®Ø·Ø© ÙƒØ£ÙŠØ§Ù… 1..30 (ÙØ·ÙˆØ±/ØºØ¯Ø§Ø¡/Ø¹Ø´Ø§Ø¡/Ø³Ù†Ø§Ùƒ).`;
  pushChat('me','ØªÙˆÙ„ÙŠØ¯ Ø®Ø·Ø© 30 ÙŠÙˆÙ…â€¦'); try{ const res=await callAI(prompt); if(res) pushChat('ai',res);}catch(e){ pushChat('ai','Ø®Ø·Ø£: '+e.message); } };
$('#suggestGoals').onclick=async()=>{ const done=goals.filter(g=>g.done).map(g=>`âœ“ ${g.text}`), pen=goals.filter(g=>!g.done).map(g=>`- ${g.text}`), steps=+localStorage.getItem('st:steps')||0, bmi=$('#bmiOut').textContent||'';
  const prompt=`Ø£Ù†Ø§ Ø·Ø§Ù„Ø¨. Ø§Ù„Ù…Ù†Ø¬Ø²: ${done.join(' | ')||'Ù„Ø§ Ø´ÙŠØ¡'}. Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${pen.join(' | ')||'Ù„Ø§ Ø´ÙŠØ¡'}. Ø®Ø·ÙˆØ§Øª Ø§Ù„ÙŠÙˆÙ… ${steps}. BMI ${bmi}. Ø§Ù‚ØªØ±Ø­ 8 Ø£Ù‡Ø¯Ø§Ù Ø°ÙƒÙŠØ© Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ù‚ÙŠØ§Ø³ Ù„Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ù‚Ø§Ø¯Ù… (Ø¯Ø±Ø§Ø³Ø©/ØµØ­Ø©/Ø¹Ø§Ø¯Ø§Øª) Ù…Ø¹ Ù†Ù‚Ø§Ø· (5-20) ÙˆÙ†ØµÙŠØ­Ø© Ù‚ØµÙŠØ±Ø© Ù„ÙƒÙ„ Ù‡Ø¯Ù.`;
  pushChat('me','Ø§Ù‚ØªØ±Ø­ Ø£Ù‡Ø¯Ø§ÙÙ‹Ø§â€¦'); try{ const res=await callAI(prompt); if(res) pushChat('ai',res);}catch(e){ pushChat('ai','Ø®Ø·Ø£: '+e.message); } };
function init(){ renderGoals(); renderSteps(); renderWater(); show('goals'); } init();
</script>
</body></html>
